<template>
  <b-container fluid>
    <div v-if="!isLoading">
      <h2>
        Vulnerability Data
      </h2>
      <b-row>
        <b-col cols="12" lg="6">
          <Navbar />
          <Description :descData="descData" />
        </b-col>
        <b-col cols="12" lg="6">
          <Chart :chartData="chartData" />
          <b-row>
            <b-col>
              <b-form-group
                id="input-group-1"
                label="With score above: "
                label-for="input-1"
              >
                <b-form-input
                  id="input-1"
                  v-model.number="score"
                  type="number"
                  placeholder="enter number"
                ></b-form-input>
              </b-form-group>
            </b-col>
            <b-col>

            </b-col>
          </b-row>

          <Table :tableData="tableData" />
        </b-col>
      </b-row>
    </div>

  </b-container>
</template>

<script>
// eslint-disable-next-line
import Chartist from 'chartist';
import Navbar from './navbar.vue';
import Description from './description.vue';
import Chart from './chart.vue';
import Table from './table.vue';

export default {
  components: {
    Navbar,
    Description,
    Chart,
    Table,
  },
  data() {
    return {
      isLoading: false,
      score: 'all',
      selected: null,
      options: [
        { value: 'all', text: 'Select all' },
        { value: 'important', text: 'Important' },
        { value: 'not_important', text: 'Not important' },
      ],
      descData: [],
      chartData: null,
      tableData: [],
      list: [],
    };
  },
  watch: {
    $route() {
      this.getData();
    },
    score(newVal) {
      if (typeof newVal === 'number') {
        const newList = this.list.filter((data) => data.score >= newVal);
        this.tableData = newList;
      }
    },
  },
  created() {
    this.getData();
  },
  methods: {
    getData() {
      this.isLoading = true;
      fetch(`/chart/${this.$route.params.id}`)
        .then((response) => response.json())
        .then((data) => {
          const { bullets, chart, list } = data;
          this.descData = bullets;
          this.chartData = chart;
          this.tableData = list;
          this.list = list;
          this.isLoading = false;
        });
    },
  },

};
</script>

<style lang='scss' scoped>

</style>
